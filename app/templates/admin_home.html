
<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"><title>Admin - Einsätze</title></head>
<body class="bg-light"><div class="container py-4">
<h1 class="mb-3">Einsätze</h1>
<form method="get" class="row gy-2 gx-2 mb-3">
  <div class="col-auto"><input type="date" class="form-control" name="date_from" value="{{ filters.date_from }}"></div>
  <div class="col-auto"><input type="date" class="form-control" name="date_to" value="{{ filters.date_to }}"></div>
  <div class="col-auto">
    <select class="form-select" name="staff_id">
      <option value="">Mitarbeiter</option>
      {% for s in staff %}
        <option value="{{ s.id }}" {% if filters.staff_id|string == s.id|string %}selected{% endif %}>{{ s.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto">
    <select class="form-select" name="apartment_id">
      <option value="">Apartment</option>
      {% for a in apartments %}
        <option value="{{ a.id }}" {% if filters.apartment_id|string == a.id|string %}selected{% endif %}>{{ a.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto"><button class="btn btn-primary">Filtern</button></div>
  <div class="col-auto"><a class="btn btn-outline-secondary" href="/admin/{{ token }}">Reset</a></div>
</form>
<div class="d-flex gap-2 mb-3">
  <a class="btn btn-outline-secondary" href="/admin/{{ token }}/staff">Team</a>
  <a class="btn btn-outline-secondary" href="/admin/{{ token }}/apartments">Apartments</a>
  <a class="btn btn-primary" href="/admin/{{ token }}/import">Import jetzt</a>
</div>
<div class="mb-2">
  <span class="badge text-bg-success">Zugewiesen</span>
  <span class="badge text-bg-warning">Ohne Zuweisung</span>
</div>
<table class="table table-sm table-hover bg-white align-middle">
<thead><tr><th>Datum</th><th>Apartment</th><th>Geplant</th><th>Next Arrival</th><th>MA</th><th>Lock</th><th>#</th></tr></thead>
<tbody>
{% for t in tasks %}
<tr class="{% if t.assigned_staff_id %}table-success{% else %}table-warning{% endif %}">
  <td>{{ t.date | date_wd_de('short') }}</td>
  <td>{{ apt_map.get(t.apartment_id, t.apartment_id) }}</td>
  <td>{{ t.planned_minutes }} min</td>
  <td>
    {% if t.next_arrival %}
      {{ t.next_arrival | date_wd_de('short') }}
      ({{ t.next_arrival_adults or 0 }}+{{ t.next_arrival_children or 0 }})<br>
      <small class="text-muted">{{ t.next_arrival_comments }}</small>
    {% else %}-{% endif %}
  </td>
  <td>
    <form method="post" action="/admin/{{ token }}/task/assign" class="d-flex gap-2">
      <input type="hidden" name="task_id" value="{{ t.id }}"/>
      <select name="staff_id_raw" class="form-select form-select-sm">
        <option value="">–</option>
        {% for s in staff %}
          <option value="{{ s.id }}" {% if t.assigned_staff_id==s.id %}selected{% endif %}>{{ s.name }}</option>
        {% endfor %}
      </select>
      <button class="btn btn-sm btn-outline-primary">Speichern</button>
    </form>
  </td>
  <td>
    <form method="post" action="/admin/{{ token }}/task/lock">
      <input type="hidden" name="task_id" value="{{ t.id }}"/>
      <input type="hidden" name="lock" value="{{ 0 if t.locked else 1 }}"/>
      <button class="btn btn-sm {{ 'btn-success' if t.locked else 'btn-outline-secondary' }}">{{ 'Locked' if t.locked else 'Lock' }}</button>
    </form>
  </td>
  <td><small>#{{ t.id }}</small></td>
</tr>
{% endfor %}
</tbody></table>
</div></body></html>
