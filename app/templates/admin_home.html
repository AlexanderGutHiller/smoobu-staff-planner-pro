<!doctype html><html lang="de"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"><title>{{ T.title_admin }}</title>
<style>
  .table td, .table th { vertical-align: middle; }
  @media (max-width: 768px) {
    .table thead { display: none; }
    .table tr { display: block; margin-bottom: 1rem; border: 1px solid #e5e5e5; border-radius: .75rem; overflow: hidden;}
    .table td { display: flex; justify-content: space-between; padding: .5rem .75rem; }
    .table td::before { content: attr(data-label); font-weight: 600; margin-right: .75rem; }
    form { width: 100%; }
  }
</style>
</head>
<body class="bg-light"><div class="container py-4">
<h1 class="mb-3">{{ T.title_admin }}</h1>
<div class="d-flex gap-2 mb-3 flex-wrap">
  <a class="btn btn-outline-secondary" href="/admin/{{ token }}/staff">{{ T.team }}</a>
  <a class="btn btn-outline-secondary" href="/admin/{{ token }}/apartments">{{ T.apartments }}</a>
  <a class="btn btn-outline-secondary" href="/admin/{{ token }}/export?month={{ today[:7] }}">{{ T.csv_export }} ({{ today[:7] }})</a>
  <a class="btn btn-success" href="/admin/{{ token }}/import">{{ T.import_now }}</a>
</div>
<table class="table table-sm table-hover bg-white align-middle">
<thead><tr>
  <th>{{ T.date }}</th><th>{{ T.start }}</th><th>{{ T.apartment }}</th><th>{{ T.next_guests }}</th><th>{{ T.planned }}</th><th>{{ T.extras }}</th><th>{{ T.note }}</th><th>{{ T.staff }}</th><th>{{ T.status }}</th><th>{{ T.action }}</th>
</tr></thead>
<tbody>
{% for t in tasks %}
{% set e = (t.extras_json and (t.extras_json|safe|loads)) or {} %}
{% set next = next_by_apartment.get(t.apartment_id) and next_by_apartment.get(t.apartment_id).get(t.date) %}
<tr>
<form method="post" action="/admin/{{ token }}/task/update" class="align-middle">
<input type="hidden" name="task_id" value="{{ t.id }}">
<td data-label="{{ T.date }}"><input type="date" name="date" class="form-control form-control-sm" value="{{ t.date }}"></td>
<td data-label="{{ T.start }}"><input type="time" name="start_time" class="form-control form-control-sm" value="{{ t.start_time or '' }}"></td>
<td data-label="{{ T.apartment }}"><select name="apartment_id" class="form-select form-select-sm">
  <option value="">-</option>
  {% for a in apts %}<option value="{{ a.id }}" {% if t.apartment_id==a.id %}selected{% endif %}>{{ a.name }}</option>{% endfor %}
</select></td>
<td data-label="{{ T.next_guests }}">
  {% if next %}{{ next.adults }} {{ T.adults_short }}, {{ next.children }} {{ T.children_short }}{% else %}—{% endif %}
</td>
<td data-label="{{ T.planned }}"><input type="number" name="planned_minutes" class="form-control form-control-sm" value="{{ t.planned_minutes }}"></td>
<td data-label="{{ T.extras }}" class="small">
  <div class="form-check"><input class="form-check-input" name="crib" type="checkbox" value="1" {% if e.get('crib') %}checked{% endif %}> {{ T.crib }}</div>
  <div class="form-check"><input class="form-check-input" name="highchair" type="checkbox" value="1" {% if e.get('highchair') %}checked{% endif %}> {{ T.highchair }}</div>
  <input class="form-control form-control-sm mt-1" name="extra_text" placeholder="{{ T.extra_work if T.get('extra_work') else 'zusätzliche Arbeiten' }}" value="{{ e.get('text','') }}">
</td>
<td data-label="{{ T.note }}"><input class="form-control form-control-sm" name="notes" value="{{ t.notes }}"></td>
<td data-label="{{ T.staff }}"><select name="assigned_staff_id" class="form-select form-select-sm">
  <option value="">—</option>
  {% for s in staff %}<option value="{{ s.id }}" {% if t.assigned_staff_id==s.id %}selected{% endif %}>{{ s.name }}</option>{% endfor %}
</select></td>
<td data-label="{{ T.status }}">
  <select form="status{{t.id}}" name="status" class="form-select form-select-sm" onchange="document.getElementById('status{{t.id}}').submit()">
    <option value="open" {% if t.status=='open' %}selected{% endif %}>{{ T.open }}</option>
    <option value="done" {% if t.status=='done' %}selected{% endif %}>{{ T.done }}</option>
  </select>
</td>
<td data-label="{{ T.action }}"><button class="btn btn-sm btn-primary w-100">{{ T.save }}</button></td>
</form>
<form id="status{{t.id}}" method="post" action="/admin/{{ token }}/task/status"><input type="hidden" name="task_id" value="{{ t.id }}"></form>
</tr>
{% endfor %}
</tbody></table>
</div></body></html>