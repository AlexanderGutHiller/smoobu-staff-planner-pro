
<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<title>Admin - Team</title>
<style>
  /* Mobile Optimierungen */
  @media (max-width: 768px) {
    .container { padding-left: 10px; padding-right: 10px; }
    .btn { padding: 0.5rem 0.75rem; font-size: 0.875rem; }
    .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .desktop-view { display: none; }
    .mobile-view { display: block; }
    
    .staff-card-mobile {
      border: 2px solid #dee2e6;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .staff-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #dee2e6;
    }
    
    .staff-info-row {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .staff-info-label {
      font-weight: 600;
      color: #6c757d;
      min-width: 120px;
    }
    
    .staff-actions {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid #dee2e6;
    }
    
    .input-group input {
      font-size: 0.875rem;
    }
  }
  
  @media (min-width: 769px) {
    .desktop-view { display: block; }
    .mobile-view { display: none; }
  }
</style>
</head>
<body class="bg-light"><div class="container py-4">
<div class="d-flex justify-content-end mb-2">
  <small class="text-muted" style="font-size:0.75rem;">{{ APP_VERSION_DISPLAY }}</small>
</div>
<h1 class="mb-3">{{ trans.team }}</h1>
<div class="d-flex gap-2 mb-3 align-items-center flex-wrap">
  <a class="btn btn-outline-secondary" href="/admin/{{ token }}"><i class="bi bi-arrow-left"></i> {{ trans.zurÃ¼ck }}</a>
  <select class="form-select form-select-sm" style="width: auto;" onchange="setLanguage(this.value)">
    <option value="de" {% if lang == 'de' %}selected{% endif %}>ğŸ‡©ğŸ‡ª Deutsch</option>
    <option value="en" {% if lang == 'en' %}selected{% endif %}>ğŸ‡¬ğŸ‡§ English</option>
    <option value="fr" {% if lang == 'fr' %}selected{% endif %}>ğŸ‡«ğŸ‡· FranÃ§ais</option>
    <option value="it" {% if lang == 'it' %}selected{% endif %}>ğŸ‡®ğŸ‡¹ Italiano</option>
    <option value="es" {% if lang == 'es' %}selected{% endif %}>ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
    <option value="ro" {% if lang == 'ro' %}selected{% endif %}>ğŸ‡·ğŸ‡´ RomÃ¢nÄƒ</option>
    <option value="ru" {% if lang == 'ru' %}selected{% endif %}>ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
    <option value="bg" {% if lang == 'bg' %}selected{% endif %}>ğŸ‡§ğŸ‡¬ Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸</option>
  </select>
  <a class="btn btn-outline-warning btn-sm" href="/admin/{{ token }}/notify_assignments" title="Zuweisungs-Mails jetzt senden"><i class="bi bi-send"></i> Zuweisungs-Mails senden</a>
</div>
<script>
function setLanguage(lang) {
  const currentPath = window.location.pathname + window.location.search;
  window.location.href = `/set-language?lang=${lang}&redirect=${encodeURIComponent(currentPath)}`;
}
</script>

<!-- Add Staff Form -->
<form method="post" action="/admin/{{ token }}/staff/add" class="row gy-2 gx-2 mb-3 align-items-end">
  <div class="col-12 col-md-auto">
    <label class="form-label small text-muted d-block">Name</label>
    <input class="form-control" name="name" placeholder="Name" required>
  </div>
  <div class="col-12 col-md-auto">
    <label class="form-label small text-muted d-block">E-Mail</label>
    <input class="form-control" name="email" type="email" placeholder="mail@example.com" required>
  </div>
  <div class="col-12 col-md-auto">
    <label class="form-label small text-muted d-block">WhatsApp/Telefon</label>
    <input class="form-control" name="phone" type="tel" placeholder="+491701234567" pattern="[+]?[0-9\s\-]+">
  </div>
  <div class="col-12 col-md-auto">
    <label class="form-label small text-muted d-block">Stundensatz</label>
    <div class="input-group">
      <span class="input-group-text">â‚¬/h</span>
      <input class="form-control" name="hourly_rate" type="number" step="0.01" value="0" placeholder="0.00">
    </div>
  </div>
  <div class="col-12 col-md-auto">
    <label class="form-label small text-muted d-block">Max. Std/Monat</label>
    <input class="form-control" name="max_hours_per_month" type="number" step="1" value="160" placeholder="160">
  </div>
  <div class="col-12 col-md-auto">
    <label class="form-label small text-muted d-block">Sprache</label>
    <select class="form-select" name="language">
      <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
      <option value="en">ğŸ‡¬ğŸ‡§ English</option>
      <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
      <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
      <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
      <option value="ro">ğŸ‡·ğŸ‡´ RomÃ¢nÄƒ</option>
      <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
      <option value="bg">ğŸ‡§ğŸ‡¬ Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸</option>
    </select>
  </div>
  <div class="col-12 col-md-auto d-flex"><button class="btn btn-primary w-100 align-self-end"><i class="bi bi-plus-lg"></i> Anlegen</button></div>
</form>

<!-- Desktop View -->
<div class="desktop-view">
<table class="table table-sm table-hover bg-white align-middle">
<thead><tr>
  <th>Name</th>
  <th>Stundensatz</th>
  <th>Max/Monat</th>
  <th>{{ trans.geleistete_stunden }}</th>
  <th>Status</th>
  <th>Magic-Link</th>
  <th>Aktion</th>
</tr></thead>
<tbody>
{% for s in staff %}
<tr>
  <td>{{ s.name }}</td>
  <td>{{ '%.2f'|format(s.hourly_rate) }} â‚¬</td>
  <td>{{ s.max_hours_per_month }}</td>
  <td>
    {% if staff_hours.get(s.id) %}
      <div class="small">
        <div><strong>{{ prev_last_month }}:</strong> {{ '%.2f'|format(staff_hours[s.id].prev_last_month) }} {{ trans.stunden }}</div>
        <div><strong>{{ last_month }}:</strong> {{ '%.2f'|format(staff_hours[s.id].last_month) }} {{ trans.stunden }}</div>
        <div><strong>{{ current_month }}:</strong> {{ '%.2f'|format(staff_hours[s.id].current_month) }} {{ trans.stunden }}</div>
      </div>
    {% else %}
      <span class="text-muted">-</span>
    {% endif %}
  </td>
  <td>{{ 'Aktiv' if s.active else 'Inaktiv' }}</td>
  <td>
    {% set link = (base_url ~ '/cleaner/' ~ s.magic_token) %}
    <div class="input-group input-group-sm">
      <input class="form-control" value="{{ link }}" readonly id="link-{{ s.id }}">
      <button class="btn btn-outline-secondary" type="button" onclick="navigator.clipboard.writeText('{{ link }}')" title="Link kopieren"><i class="bi bi-clipboard"></i></button>
      <a class="btn btn-outline-primary" href="{{ link }}" target="_blank" title="Link Ã¶ffnen"><i class="bi bi-box-arrow-up-right"></i></a>
    </div>
  </td>
  <td>
    <form method="post" action="/admin/{{ token }}/staff/toggle">
      <input type="hidden" name="staff_id" value="{{ s.id }}"/>
      <button class="btn btn-sm {{ 'btn-outline-danger' if s.active else 'btn-success' }}">
        {% if s.active %}<i class="bi bi-person-slash"></i> Deaktivieren{% else %}<i class="bi bi-person-check"></i> Aktivieren{% endif %}
      </button>
    </form>
    <button class="btn btn-sm btn-outline-secondary ms-1" type="button" onclick="toggleEdit({{ s.id }})"><i class="bi bi-pencil"></i> Bearbeiten</button>
    <form method="post" action="/admin/{{ token }}/staff/delete" class="d-inline ms-1" onsubmit="return confirm('Diesen Mitarbeiter wirklich lÃ¶schen? Zugeordnete Aufgaben werden entkoppelt.');">
      <input type="hidden" name="staff_id" value="{{ s.id }}"/>
      <button class="btn btn-sm btn-outline-danger" title="LÃ¶schen"><i class="bi bi-trash"></i></button>
    </form>
  </td>
</tr>
<tr id="edit-row-{{ s.id }}" style="display:none;">
  <td colspan="7">
    <form method="post" action="/admin/{{ token }}/staff/update" class="row gy-2 gx-2 align-items-end">
      <input type="hidden" name="staff_id" value="{{ s.id }}"/>
      <div class="col-12 col-md-auto">
        <label class="form-label small text-muted d-block">Name</label>
        <input class="form-control" name="name" value="{{ s.name }}" required>
      </div>
      <div class="col-12 col-md-auto">
        <label class="form-label small text-muted d-block">E-Mail</label>
        <input class="form-control" name="email" type="email" value="{{ s.email }}" required>
      </div>
      <div class="col-12 col-md-auto">
        <label class="form-label small text-muted d-block">WhatsApp/Telefon</label>
        <input class="form-control" name="phone" type="tel" value="{{ s.phone if s.phone else '' }}" placeholder="+491701234567" pattern="[+]?[0-9\s\-]+">
      </div>
      <div class="col-12 col-md-auto">
        <label class="form-label small text-muted d-block">Stundensatz</label>
        <div class="input-group">
          <span class="input-group-text">â‚¬/h</span>
          <input class="form-control" name="hourly_rate" type="number" step="0.01" value="{{ '%.2f'|format(s.hourly_rate) }}">
        </div>
      </div>
      <div class="col-12 col-md-auto">
        <label class="form-label small text-muted d-block">Max. Std/Monat</label>
        <input class="form-control" name="max_hours_per_month" type="number" step="1" value="{{ s.max_hours_per_month }}">
      </div>
      <div class="col-12 col-md-auto">
        <label class="form-label small text-muted d-block">Sprache</label>
        <select class="form-select" name="language">
          <option value="de" {% if s.language=='de' %}selected{% endif %}>ğŸ‡©ğŸ‡ª Deutsch</option>
          <option value="en" {% if s.language=='en' %}selected{% endif %}>ğŸ‡¬ğŸ‡§ English</option>
          <option value="fr" {% if s.language=='fr' %}selected{% endif %}>ğŸ‡«ğŸ‡· FranÃ§ais</option>
          <option value="it" {% if s.language=='it' %}selected{% endif %}>ğŸ‡®ğŸ‡¹ Italiano</option>
          <option value="es" {% if s.language=='es' %}selected{% endif %}>ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
          <option value="ro" {% if s.language=='ro' %}selected{% endif %}>ğŸ‡·ğŸ‡´ RomÃ¢nÄƒ</option>
          <option value="ru" {% if s.language=='ru' %}selected{% endif %}>ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
          <option value="bg" {% if s.language=='bg' %}selected{% endif %}>ğŸ‡§ğŸ‡¬ Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸</option>
        </select>
      </div>
      <div class="col-12 col-md-auto d-flex">
        <button class="btn btn-success"><i class="bi bi-save"></i> Speichern</button>
        <button class="btn btn-link ms-2" type="button" onclick="toggleEdit({{ s.id }})">Abbrechen</button>
      </div>
    </form>
  </td>
</tr>
{% endfor %}
</tbody></table>
</div>

<!-- Mobile View -->
<div class="mobile-view">
{% for s in staff %}
<div class="staff-card-mobile">
  <div class="staff-card-header">
    <div>
      <h5 class="mb-0 fw-bold">{{ s.name }}</h5>
      <span class="badge {% if s.active %}bg-success{% else %}bg-secondary{% endif %}">
        {% if s.active %}Aktiv{% else %}Inaktiv{% endif %}
      </span>
    </div>
  </div>
  
  <div class="staff-info-row">
    <span class="staff-info-label">Stundensatz:</span>
    <span class="fw-bold">{{ '%.2f'|format(s.hourly_rate) }} â‚¬</span>
  </div>
  
  <div class="staff-info-row">
    <span class="staff-info-label">Max/Monat:</span>
    <span class="fw-bold">{{ s.max_hours_per_month }} {{ trans.stunden }}</span>
  </div>
  
  {% if staff_hours.get(s.id) %}
  <div class="staff-info-row">
    <span class="staff-info-label">{{ trans.geleistete_stunden }}:</span>
    <span class="small">
      <div><strong>{{ prev_last_month }}:</strong> {{ '%.2f'|format(staff_hours[s.id].prev_last_month) }} {{ trans.stunden }}</div>
      <div><strong>{{ last_month }}:</strong> {{ '%.2f'|format(staff_hours[s.id].last_month) }} {{ trans.stunden }}</div>
      <div><strong>{{ current_month }}:</strong> {{ '%.2f'|format(staff_hours[s.id].current_month) }} {{ trans.stunden }}</div>
    </span>
  </div>
  {% else %}
  <div class="staff-info-row">
    <span class="staff-info-label">{{ trans.geleistete_stunden }}:</span>
    <span class="text-muted">-</span>
  </div>
  {% endif %}
  
  <div class="staff-actions">
    <div class="mb-2">
      <label class="form-label small fw-bold">Magic-Link:</label>
      {% set link = (base_url ~ '/cleaner/' ~ s.magic_token) %}
      <div class="input-group input-group-sm">
        <input class="form-control" value="{{ link }}" readonly id="link-mobile-{{ s.id }}" style="font-size: 0.75rem;">
        <button class="btn btn-outline-secondary" type="button" onclick="navigator.clipboard.writeText('{{ link }}')" title="Link kopieren"><i class="bi bi-clipboard"></i></button>
        <a class="btn btn-outline-primary" href="{{ link }}" target="_blank" title="Link Ã¶ffnen"><i class="bi bi-box-arrow-up-right"></i></a>
      </div>
    </div>
    
    <form method="post" action="/admin/{{ token }}/staff/toggle" class="w-100">
      <input type="hidden" name="staff_id" value="{{ s.id }}"/>
      <button class="btn w-100 {{ 'btn-outline-danger' if s.active else 'btn-success' }}" type="submit">
        {% if s.active %}<i class="bi bi-person-slash"></i> Deaktivieren{% else %}<i class="bi bi-person-check"></i> Aktivieren{% endif %}
      </button>
    </form>
    <button class="btn btn-outline-secondary w-100" type="button" onclick="toggleEdit('m{{ s.id }}')"><i class="bi bi-pencil"></i> Bearbeiten</button>
    <div id="edit-card-m{{ s.id }}" style="display:none;" class="mt-2">
      <form method="post" action="/admin/{{ token }}/staff/update" class="row gy-2 gx-2">
        <input type="hidden" name="staff_id" value="{{ s.id }}"/>
        <div class="col-12">
          <label class="form-label small text-muted d-block">Name</label>
          <input class="form-control" name="name" value="{{ s.name }}" required>
        </div>
        <div class="col-12">
          <label class="form-label small text-muted d-block">E-Mail</label>
          <input class="form-control" name="email" type="email" value="{{ s.email }}" required>
      </div>
      <div class="col-12 col-md-auto">
        <label class="form-label small text-muted d-block">WhatsApp/Telefon</label>
        <input class="form-control" name="phone" type="tel" value="{{ s.phone if s.phone else '' }}" placeholder="+491701234567" pattern="[+]?[0-9\s\-]+">
        </div>
        <div class="col-6">
          <label class="form-label small text-muted d-block">â‚¬/h</label>
          <input class="form-control" name="hourly_rate" type="number" step="0.01" value="{{ '%.2f'|format(s.hourly_rate) }}">
        </div>
        <div class="col-6">
          <label class="form-label small text-muted d-block">Max./Monat</label>
          <input class="form-control" name="max_hours_per_month" type="number" step="1" value="{{ s.max_hours_per_month }}">
        </div>
        <div class="col-12">
          <label class="form-label small text-muted d-block">Sprache</label>
          <select class="form-select" name="language">
            <option value="de" {% if s.language=='de' %}selected{% endif %}>ğŸ‡©ğŸ‡ª Deutsch</option>
            <option value="en" {% if s.language=='en' %}selected{% endif %}>ğŸ‡¬ğŸ‡§ English</option>
            <option value="fr" {% if s.language=='fr' %}selected{% endif %}>ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="it" {% if s.language=='it' %}selected{% endif %}>ğŸ‡®ğŸ‡¹ Italiano</option>
            <option value="es" {% if s.language=='es' %}selected{% endif %}>ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
            <option value="ro" {% if s.language=='ro' %}selected{% endif %}>ğŸ‡·ğŸ‡´ RomÃ¢nÄƒ</option>
            <option value="ru" {% if s.language=='ru' %}selected{% endif %}>ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            <option value="bg" {% if s.language=='bg' %}selected{% endif %}>ğŸ‡§ğŸ‡¬ Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸</option>
          </select>
        </div>
        <div class="col-12 d-flex gap-2">
          <button class="btn btn-success w-100" type="submit"><i class="bi bi-save"></i> Speichern</button>
          <button class="btn btn-link w-100" type="button" onclick="toggleEdit('m{{ s.id }}')">Abbrechen</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endfor %}
</div>

<script>
function toggleEdit(id){
  const isMobile = (typeof id === 'string' && id.startsWith('m'));
  const targetId = isMobile ? `edit-card-${id}` : `edit-row-${id}`;
  const row = document.getElementById(targetId);
  if (!row) return;
  // Nutze computed style, falls kein inline-style gesetzt ist
  const current = window.getComputedStyle(row).display;
  if (current === 'none') {
    row.style.display = isMobile ? 'block' : 'table-row';
    row.scrollIntoView({ behavior: 'smooth', block: 'center' });
  } else {
    row.style.display = 'none';
  }
}
</script>
</div></body></html>